{% extends "base.html" %}

{% block lab %}–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 7{% endblock %}

{% block script %}
<link rel="stylesheet" href="{{ url_for('static', filename='lab7/style.css') }}">
<script src="{{ url_for('static', filename='lab7/main.js') }}"></script>
<style>
    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.4);
    }
    
    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 30px;
        border: 1px solid #888;
        border-radius: 10px;
        width: 500px;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        max-height: 80vh;
        overflow-y: auto;
    }
    
    .modal h2 {
        margin-top: 0;
        color: #333;
        border-bottom: 2px solid #4CAF50;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    
    .modal label {
        display: block;
        margin-bottom: 15px;
        color: #555;
        font-weight: bold;
    }
    
    .modal input[type="text"],
    .modal input[type="number"],
    .modal textarea {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        margin-bottom: 5px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 14px;
    }
    
    .modal input[type="text"]:focus,
    .modal input[type="number"]:focus,
    .modal textarea:focus {
        border-color: #4CAF50;
        outline: none;
        box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
    }
    
    .modal textarea {
        height: 150px;
        resize: vertical;
        font-family: Arial, sans-serif;
    }
    
    .modal-buttons {
        text-align: right;
        margin-top: 25px;
        padding-top: 15px;
        border-top: 1px solid #eee;
    }
    
    .modal-buttons button {
        margin-left: 10px;
        min-width: 100px;
    }
    
    .error-message {
        color: #d32f2f;
        font-size: 12px;
        margin-top: 3px;
        margin-bottom: 10px;
        display: block;
    }
    
    .hint {
        font-size: 12px;
        color: #666;
        font-style: italic;
        margin-top: 3px;
        display: block;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    table th {
        background-color: #4CAF50;
        color: white;
        padding: 12px 15px;
        text-align: left;
        font-weight: bold;
    }
    
    table td {
        padding: 12px 15px;
        border-bottom: 1px solid #ddd;
        vertical-align: middle;
    }
    
    table tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    
    table tr:hover {
        background-color: #f5f5f5;
    }
    
    table tr:last-child td {
        border-bottom: 2px solid #4CAF50;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è */
    .original-title {
        font-style: italic;
        color: #666;
        font-size: 0.9em;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ */
    .actions-cell {
        white-space: nowrap;
    }
    
    .actions-cell button {
        margin: 0 5px;
        padding: 6px 12px;
        font-size: 13px;
    }
    
    /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
    .edit-btn {
        background-color: #2196F3;
    }
    
    .edit-btn:hover {
        background-color: #1976D2;
    }
    
    .delete-btn {
        background-color: #f44336;
    }
    
    .delete-btn:hover {
        background-color: #d32f2f;
    }
    
    .add-btn {
        background-color: #FF9800;
        padding: 12px 24px;
        font-size: 16px;
        font-weight: bold;
        border-radius: 6px;
        transition: all 0.3s;
    }
    
    .add-btn:hover {
        background-color: #F57C00;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
    button {
        padding: 8px 16px;
        margin: 5px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s, transform 0.2s;
    }
    
    button:hover {
        transform: translateY(-1px);
    }
    
    button:active {
        transform: translateY(0);
    }
    
    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    h1 {
        color: #333;
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 3px solid #4CAF50;
    }
    
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è */
    .add-container {
        text-align: center;
        margin-top: 30px;
        margin-bottom: 30px;
    }
    
    /* –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –ø—É—Å—Ç–æ–π —Ç–∞–±–ª–∏—Ü–µ */
    .empty-message {
        text-align: center;
        padding: 40px;
        color: #777;
        font-style: italic;
        font-size: 18px;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
        .modal-content {
            width: 90%;
            margin: 10% auto;
        }
        
        table {
            font-size: 14px;
        }
        
        table th, table td {
            padding: 8px;
        }
        
        .actions-cell button {
            display: block;
            width: 100%;
            margin: 5px 0;
        }
    }
</style>
{% endblock %}

{% block main %}
    <h1>üìΩÔ∏è –°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤</h1>
    
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th width="25%">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th width="25%">–†—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th width="15%">–ì–æ–¥</th>
                    <th width="35%">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="film-list">
                <!-- –¢–∞–±–ª–∏—Ü–∞ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ JavaScript -->
            </tbody>
        </table>
        
        <div id="empty-table-message" class="empty-message" style="display: none;">
            –ù–µ—Ç —Ñ–∏–ª—å–º–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ñ–∏–ª—å–º!
        </div>
    </div>
    
    <div class="add-container">
        <button class="add-btn" onclick="addFilm()">
            <span style="font-size: 18px; margin-right: 8px;">+</span> –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∏–ª—å–º
        </button>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏–ª—å–º–∞ -->
    <div id="film-modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</h2>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è ID —Ñ–∏–ª—å–º–∞ (–ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏) -->
            <input type="hidden" id="id">
            
            <form id="film-form" onsubmit="event.preventDefault(); sendFilm();">
                <label>
                    –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º: *
                    <input type="text" id="title_ru" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º" required>
                    <span id="title_ru_error" class="error-message"></span>
                </label>
                
                <label>
                    –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º —è–∑—ã–∫–µ:
                    <input type="text" id="title" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                    <span id="title_error" class="error-message"></span>
                    <span class="hint">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ —Ñ–∏–ª—å–º —Ä—É—Å—Å–∫–∏–π (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Ä—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)</span>
                </label>
                
                <label>
                    –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: *
                    <input type="number" id="year" 
                           min="1895" 
                           max="{{ current_year }}" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1994" 
                           required>
                    <span id="year_error" class="error-message"></span>
                    <span class="hint">–ì–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1895 (–ø–µ—Ä–≤—ã–π —Ñ–∏–ª—å–º) –¥–æ —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–∞</span>
                </label>
                
                <label>
                    –û–ø–∏—Å–∞–Ω–∏–µ: *
                    <textarea id="description" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞..." required></textarea>
                    <span id="description_error" class="error-message"></span>
                    <span class="hint">–ú–∞–∫—Å–∏–º—É–º 2000 —Å–∏–º–≤–æ–ª–æ–≤</span>
                    <div style="text-align: right; font-size: 12px; color: #999;">
                        <span id="char-count">0</span>/2000 —Å–∏–º–≤–æ–ª–æ–≤
                    </div>
                </label>
                
                <div class="modal-buttons">
                    <button type="button" class="delete-btn" onclick="cancel()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="edit-btn" id="submit-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è
        document.getElementById('description').addEventListener('input', function() {
            const count = this.value.length;
            document.getElementById('char-count').textContent = count;
            
            if (count > 2000) {
                document.getElementById('description_error').innerText = '–°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–º–∞–∫—Å–∏–º—É–º 2000 —Å–∏–º–≤–æ–ª–æ–≤)';
            } else {
                document.getElementById('description_error').innerText = '';
            }
        });
        
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –≥–æ–¥ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        const currentYear = new Date().getFullYear();
        if (document.getElementById('year')) {
            document.getElementById('year').max = currentYear;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ñ–∏–ª—å–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function checkEmptyTable() {
            const filmList = document.getElementById('film-list');
            const emptyMessage = document.getElementById('empty-table-message');
            
            if (filmList.children.length === 0) {
                emptyMessage.style.display = 'block';
            } else {
                emptyMessage.style.display = 'none';
            }
        }
        
        // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º fillFilmList –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É—Å—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã
        const originalFillFilmList = fillFilmList;
        fillFilmList = function() {
            return originalFillFilmList().then(function() {
                setTimeout(checkEmptyTable, 100); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM
            });
        };
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –Ω–∞–∂–∞—Ç–∏—é Esc
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                hideModal();
            }
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            fillFilmList();
            checkEmptyTable();
        });
    </script>
    
    <div style="margin-top: 40px; padding: 20px; background-color: #f8f9fa; border-radius: 8px; border-left: 4px solid #4CAF50;">
        <h3 style="margin-top: 0; color: #333;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ —Å —Ñ–∏–ª—å–º–∞–º–∏:</h3>
        <ul style="color: #555;">
            <li>–î–ª—è <strong>–¥–æ–±–∞–≤–ª–µ–Ω–∏—è</strong> –Ω–æ–≤–æ–≥–æ —Ñ–∏–ª—å–º–∞ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∏–ª—å–º"</li>
            <li>–î–ª—è <strong>—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</strong> —Ñ–∏–ª—å–º–∞ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –≤ —Å—Ç—Ä–æ–∫–µ —Å —Ñ–∏–ª—å–º–æ–º</li>
            <li>–î–ª—è <strong>—É–¥–∞–ª–µ–Ω–∏—è</strong> —Ñ–∏–ª—å–º–∞ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–£–¥–∞–ª–∏—Ç—å" –≤ —Å—Ç—Ä–æ–∫–µ —Å —Ñ–∏–ª—å–º–æ–º</li>
            <li>–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</li>
            <li>–ü–æ–ª—è, –æ—Ç–º–µ—á–µ–Ω–Ω—ã–µ *, —è–≤–ª—è—é—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è</li>
        </ul>
    </div>
{% endblock %}